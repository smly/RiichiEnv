grp:
  train_data:
    - /data/workspace/riichienv/datasets/train_grp.pq
    - /data/workspace/riichienv/datasets/train_grp_2024.pq
  val_data: /data/workspace/riichienv/datasets/val_grp.pq
  output: /data/workspace/riichienv/ppo/grp_model.pth
  device: cuda
  batch_size: 128
  num_workers: 12
  num_epochs: 10
  lr: 5e-4
  input_dim: 20

cql:
  data_glob: "/data/mjsoul/mahjong_game_record_4p_thr_202[45]*/*.bin.xz"
  grp_model: /data/workspace/riichienv/ppo/grp_model.pth
  output: /data/workspace/riichienv/ppo/cql_model.pth
  device: cuda
  batch_size: 128
  lr: 5e-4
  alpha: 5.0
  gamma: 1.0
  num_epochs: 10
  num_workers: 12
  limit: 2000000
  pts_weight: [6.0, 4.0, 2.0, 0.0]
  weight_decay: 0.1
  aux_weight: 0.2
  wandb_entity: smly
  wandb_project: riichienv-offline
  model_class: riichienv_ml.models.cql_model.QNetwork
  dataset_class: riichienv_ml.data.cql_dataset.MCDataset
  model:
    in_channels: 74
    num_blocks: 16
    conv_channels: 192
    fc_dim: 512
    num_actions: 82
    aux_dims: 4

online:
  algorithm: ppo
  load_model: /data/workspace/riichienv/ppo/cql_model.pth
  device: cuda
  model_class: riichienv_ml.models.actor_critic.ActorCriticNetwork
  encoder_class: riichienv_ml.data.cql_dataset.ObservationEncoder
  num_workers: 4
  num_steps: 500
  lr: 1e-5
  gamma: 1.0
  max_grad_norm: 0.5
  # PPO params (conservative for fine-tuning)
  ppo_clip: 0.02               # very tight: preserve pretrained policy
  ppo_epochs: 2                # less reuse: reduce policy change per step
  gae_lambda: 0.95
  entropy_coef: 0.001          # small positive: encourage exploration
  value_coef: 0.5
  # GRP reward shaping (per-kyoku reward)
  grp_model: /data/workspace/riichienv/ppo/grp_model.pth
  pts_weight: [6.0, 4.0, 2.0, 0.0]
  weight_decay: 0.1
  alpha_kl: 0.1                # KL regularization to pretrained CQL policy (prevents drift)
  alpha_kl_warmup_steps: 50    # warmup: alpha_kl scales from 0â†’full over first 50 steps
  aux_weight: 0.0
  # Async double buffering: overlap rollout collection with PPO update
  async_rollout: true
  # Common
  eval_interval: 50
  eval_episodes: 192
  worker_device: cuda
  gpu_per_worker: 0.2
  num_envs_per_worker: 48
  checkpoint_dir: /data/workspace/riichienv/ppo/checkpoints
  wandb_project: riichienv-online
  model:
    in_channels: 74
    num_blocks: 16
    conv_channels: 192
    fc_dim: 512
    num_actions: 82
    aux_dims: 4
